# 海龟汤插件 (My_Fucked_turtle_soup)

## 概述

海龟汤插件是一个基于AI的互动游戏插件，为用户提供有趣的海龟汤题目和游戏体验。用户可以通过命令与插件互动，进行提问、获取提示、整理线索，猜测汤底，或直接揭晓答案。插件支持由AI动态生成题目，也支持从本地文件加载预设的经典题目。

## 功能特性

- 🎯 **生成海龟汤题目**：使用AI生成原创的海龟汤推理题目，或从本地库随机/指定选择。
- 💬 **互动提问**：向AI提问关于题目细节，AI会判断问题与汤底的关系（是/否/无关/是也不是）。
- 🔍 **获取提示**：在游戏过程中获取最多3次提示机会。
- 📝 **整理线索**：获取题目关键线索的整理，帮助推理。
- 🧠 **猜谜游戏**：尝试猜测汤底答案，AI会判断对错。
- 🚪 **退出游戏**：随时主动退出当前游戏。
- 🔍 **揭晓答案**：直接揭晓汤底，结束游戏。
- 📖 **帮助信息**：随时查看可用命令列表。
- 🛡️ **反注入检测**：内置违禁词列表，防止提示词注入攻击。
- 💾 **本地题目库**：
  - `/hgt 载入`：从插件目录下的 `turtle.json` 文件加载本地题目。
  - `/hgt 列表`：查看已加载的本地题目列表及其序号。
  - `/hgt 本地`：随机使用一个已加载的本地题目开始游戏。
  - `/hgt 本地 <序号>`：使用指定序号的已加载本地题目开始游戏。

## 使用方法

### 基本命令

| 命令 | 说明 |
| :--- | :--- |
| `/hgt 问题` | 生成一个新的AI海龟汤题目，开始游戏。 |
| `/hgt 问题 <你的问题>` | 向AI提问关于当前题目的问题。 |
| `/hgt 提示` | 获取一个关于当前题目的提示（最多3次）。 |
| `/hgt 整理线索` | 获取当前题目的关键线索整理。 |
| `/hgt 猜谜 <你的答案>` | 尝试猜测当前题目的汤底（答案）。 |
| `/hgt 揭秘` | 直接揭晓当前题目的汤底，并结束游戏。 |
| `/hgt 退出` | 退出当前正在进行的游戏。 |
| `/hgt 帮助` | 查看所有可用的命令帮助信息。 |
| `/hgt 汤面` | 重新查看当前游戏的题目（汤面）。 |
| `/hgt 载入` | 从插件目录下的 `turtle.json` 文件加载本地海龟汤题目。 |
| `/hgt 列表` | 查看已载入的本地海龟汤题目列表及其序号。 |
| `/hgt 本地` | 从已载入的本地题目库中随机选择一个开始游戏。 |
| `/hgt 本地 <序号>` | 使用 `/hgt 列表` 中显示的序号，选择一个特定的本地题目开始游戏。 |

### 游戏流程示例 (AI题目)

1.  发送 `/hgt 问题` 生成一个由AI创造的海龟汤题目并开始游戏。
2.  使用 `/hgt 问题 为什么...?` 进行提问，获取推理线索。
3.  使用 `/hgt 提示` 获取提示（最多3次）。
4.  使用 `/hgt 整理线索` 整理已有信息。
5.  使用 `/hgt 猜谜 <你的答案>` 尝试猜测汤底。
6.  猜对或使用 `/hgt 揭秘` 后，游戏结束。

### 游戏流程示例 (本地题目 - 指定序号)

1.  确保你的插件目录下有 `turtle.json` 文件并包含有效题目。
2.  发送 `/hgt 载入` 加载本地题目到内存。
3.  发送 `/hgt 列表` 查看已加载的题目及其序号。
4.  发送 `/hgt 本地 3` 启动列表中第3个题目。
5.  后续步骤与AI题目游戏流程相同（提问、提示、猜谜等）。

### 本地题目库 (`turtle.json`)

要使用本地题目功能，你需要在插件目录下创建一个名为 `turtle.json` 的文件。该文件应包含一个海龟汤对象的数组。

**`turtle.json` 文件格式示例:**

```json
[
  {
    "name": "子的爱",
    "question": "我的父母都不理我，但我还是很爱他们。",
    "answer": "小时候我是个很听话的孩子，爸爸妈妈经常给我好吃的水果，我吃不完。他们就告诉我喜欢的东西一定要放进冰箱，这样可以保鲜，记得那时候他们工作可辛苦了，经常加班到深夜。没睡过一个好觉。于是我耍了个小聪明，在他们的水里下了安眠药。他们睡得可香了，然后我把他们放进冰箱里，从那以后我每天都会对他们说：爸爸妈妈我爱你们。现在我都六十了，他们还是那么年轻。"
  },
  {
    "name": "舞",
    "question": "我六岁那年，外公去世，我和亲人一起去祭奠，和姐姐玩捉迷藏，然后我对母亲说了句话把她吓昏了过去。",
    "answer": "我去参加外公的葬礼，同行的还有比我大两岁的姐姐，我和她完捉迷藏我没有找到她没想到她躲在了纸做的房子里，当纸房子被点燃，我看见姐姐在跳舞，我对妈说，妈姐姐在那房子里面跳舞，因为姐姐被烧死了，我一直记得这个事。"
  }
]
```

## 配置文件

插件会自动生成 `config.toml` 配置文件，用户可以修改以下配置项：

-   `plugin.enabled`: 是否启用插件。
-   `llm.api_url`: LLM API 地址 (必须是OpenAI兼容格式)。
-   `llm.api_key`: LLM API 密钥。
-   `llm.model`: 使用的LLM模型名称。
-   `llm.temperature`: LLM 生成文本的随机性 (0.0-1.0)。
-   `anti_abuse.ban_history`: 用于检测提示词注入的违禁词列表。

> ⚠️ **重要**：配置文件是系统自动生成的，请勿手动创建！首次加载插件时会自动创建。请确保配置了有效的 `llm.api_url` 和 `llm.api_key`。

## 依赖

- `aiohttp`: 用于异步HTTP请求调用LLM API。

## 注意事项

- 需要配置有效的、符合OpenAI API格式的LLM API密钥和地址才能正常使用AI生成功能。
- 游戏状态保存在内存中，重启服务后会丢失。
- 每个聊天上下文（如群聊或私聊）拥有独立的游戏状态。
- 请遵守社区规范，合理使用插件功能。
- 本地题目库 (`turtle.json`) 需要用户自行创建和维护。

## 开发者信息

- **插件名称**: My_Fucked_turtle_soup
- **版本**: 1.4.2
- **作者**: Unreal

## 许可证

MIT License